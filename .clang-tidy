# Kalahari C++ Static Analysis Configuration
# ClangTidy 14+
# Enforces modern C++20 best practices and catches common bugs

---
Checks: >
  *,
  -abseil-*,
  -altera-*,
  -android-*,
  -darwin-*,
  -fuchsia-*,
  -google-*,
  -llvm-*,
  -llvmlibc-*,
  -objc-*,
  -zircon-*,
  bugprone-*,
  cert-*,
  clang-analyzer-*,
  concurrency-*,
  cppcoreguidelines-*,
  -cppcoreguidelines-avoid-magic-numbers,
  -cppcoreguidelines-pro-bounds-array-to-pointer-decay,
  -cppcoreguidelines-pro-bounds-pointer-arithmetic,
  -cppcoreguidelines-pro-type-vararg,
  misc-*,
  modernize-*,
  performance-*,
  portability-*,
  readability-*,
  -readability-magic-numbers,
  -readability-identifier-length,
  -readability-function-cognitive-complexity

# Warnings as errors (strict mode)
WarningsAsErrors: ''

# Header filter (only check our code)
HeaderFilterRegex: 'include/kalahari/.*'

# Check options
CheckOptions:
  # Naming conventions (Kalahari style)
  - key: readability-identifier-naming.ClassCase
    value: CamelCase
  - key: readability-identifier-naming.StructCase
    value: CamelCase
  - key: readability-identifier-naming.EnumCase
    value: CamelCase
  - key: readability-identifier-naming.FunctionCase
    value: camelBack
  - key: readability-identifier-naming.MethodCase
    value: camelBack
  - key: readability-identifier-naming.VariableCase
    value: camelBack
  - key: readability-identifier-naming.ParameterCase
    value: camelBack
  - key: readability-identifier-naming.MemberCase
    value: camelBack
  - key: readability-identifier-naming.MemberPrefix
    value: 'm_'
  - key: readability-identifier-naming.ConstantCase
    value: UPPER_CASE
  - key: readability-identifier-naming.ConstantMemberCase
    value: UPPER_CASE
  - key: readability-identifier-naming.ConstantMemberPrefix
    value: 'k'
  - key: readability-identifier-naming.NamespaceCase
    value: lower_case
  - key: readability-identifier-naming.MacroCase
    value: UPPER_CASE

  # Modernize options
  - key: modernize-use-nullptr.NullMacros
    value: 'NULL'
  - key: modernize-use-override.IgnoreDestructors
    value: 'true'

  # Performance options
  - key: performance-move-const-arg.CheckTriviallyCopyableMove
    value: 'false'

  # Readability options
  - key: readability-function-size.LineThreshold
    value: '100'
  - key: readability-function-size.StatementThreshold
    value: '50'
  - key: readability-function-size.BranchThreshold
    value: '10'
  - key: readability-function-size.ParameterThreshold
    value: '6'
  - key: readability-simplify-boolean-expr.ChainedConditionalReturn
    value: 'true'
  - key: readability-simplify-boolean-expr.ChainedConditionalAssignment
    value: 'true'

  # Bugprone options
  - key: bugprone-assert-side-effect.AssertMacros
    value: 'assert,wxASSERT,wxASSERT_MSG'
  - key: bugprone-string-constructor.WarnOnLargeLength
    value: 'true'
  - key: bugprone-string-constructor.LargeLengthThreshold
    value: '8388608'

  # Cert options
  - key: cert-err33-c.CheckedFunctions
    value: '::aligned_alloc;::calloc;::malloc;::realloc;::fopen'

---
